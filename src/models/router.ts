import { cfInfer } from './cloudflare'; import { openaiInfer } from './openai'; import { hfInfer } from './huggingface'; import { openrouterInfer } from './openrouter'; export type Purpose='concept'|'formula'|'comparison'|'design'|'general'; export function selectModel(provider:string,purpose:Purpose){const CF='@cf/meta/llama-3.1-8b-instruct',OA='gpt-4o-mini',HF='HuggingFaceH4/zephyr-7b-beta',OR='meta-llama/llama-3.1-8b-instruct:free'; return provider==='cloudflare'?CF:provider==='openai'?OA:provider==='huggingface'?HF:OR;} export async function invokeModel(provider:string,model:string,input:string,env:any){ if(provider==='cloudflare') return await cfInfer(env.AI,model,input); if(provider==='openai') return await openaiInfer(env.OPENAI_KEY,model,input); if(provider==='huggingface') return await hfInfer(env.HF_TOKEN,model,input); if(provider==='openrouter') return await openrouterInfer(env.OPENROUTER_KEY,model,input); throw new Error('unknown provider'); } export async function routerInfer(task:{purpose:Purpose;input:string},env:any){ const chain=['cloudflare','openai','huggingface','openrouter'] as const; for(const p of chain){ try{ const m=selectModel(p,task.purpose); const r=await invokeModel(p,m,task.input,env); if(r) return r; }catch(e){} } return '❌ همه مدل‌ها در دسترس نیستند. لطفاً بعداً دوباره امتحان کنید.';}\n