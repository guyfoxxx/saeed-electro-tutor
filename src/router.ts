import { handleTelegramWebhook } from './telegram/bot'; import type { TelegramUpdate } from './telegram/bot'; import { adminData } from './dashboard/admin'; import { teacherData } from './dashboard/teacher'; import { diag } from './dashboard/diag'; const DASHBOARD_HTML="<!doctype html><html><head><meta charset='utf-8'><title>Saeed \u2014 Dashboard</title><style>:root{font-family:ui-sans-serif,system-ui,-apple-system}body{margin:24px;background:#0b0c10;color:#c5c6c7}a{color:#66fcf1;text-decoration:none}header{display:flex;gap:12px;align-items:center;margin-bottom:12px}pre{background:#1f2833;padding:12px;border-radius:8px;overflow:auto}section#nav{margin:8px 0 16px}.card{background:#1f2833;padding:16px;border-radius:10px}</style></head><body><header><strong>Saeed</strong> Dashboard</header><section id='nav'><a href='#' onclick=\"load('/dashboard/admin');return false;\">Admin</a> \u2022 <a href='#' onclick=\"load('/dashboard/teacher');return false;\">Teacher</a> \u2022 <a href='#' onclick=\"load('/diag');return false;\">Diagnostics</a></section><main class='card'><pre id='root'>...</pre></main><script type='module'>async function load(w){const r=await fetch(w);const d=await r.json().catch(()=>({error:true}));document.getElementById('root').textContent=JSON.stringify(d,null,2);}</script></body></html>"; export async function route(request:Request,env:any,ctx:ExecutionContext){ const url=new URL(request.url); const p=url.pathname; if(p==='/'||p==='/dashboard') return new Response(DASHBOARD_HTML,{headers:{'content-type':'text/html; charset=utf-8'}}); if(p==='/webhook'&&request.method==='POST'){ const update=(await request.json()) as TelegramUpdate; return await handleTelegramWebhook(update, env); } if(p==='/dashboard/admin') return Response.json(await adminData(env)); if(p==='/dashboard/teacher') return Response.json(await teacherData(env)); if(p==='/diag') return Response.json(await diag(env)); return new Response('Not found',{status:404}); }\n